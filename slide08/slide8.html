<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מתאם וקורלציה</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        .slide-container {
            width: 1280px;
            height: 720px;
            background: #F2F9FC;
            font-family: 'Heebo', sans-serif;
            direction: rtl;
        }
        .title {
            color: #12377A;
            font-size: 36px;
            font-weight: 700;
        }
        .content-text {
            color: #858481;
            font-size: 20px;
            line-height: 1.3;
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #495057;
            direction: ltr;
            text-align: left;
        }
        .python-keyword { color: #0000ff; }
        .python-string { color: #008000; }
        .python-comment { color: #808080; }
        .correlation-cell {
            stroke: #fff;
            stroke-width: 1;
            cursor: pointer;
        }
        .correlation-text {
            font-family: 'Heebo', sans-serif;
            font-size: 12px;
            text-anchor: middle;
            dominant-baseline: middle;
            pointer-events: none;
        }
        .axis-label {
            font-family: 'Heebo', sans-serif;
            font-size: 14px;
            text-anchor: middle;
        }
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
        }
    </style>
</head>
<body>
    <div class="slide-container flex flex-col p-6">
        <!-- Header -->
        <div class="mb-4">
            <h1 class="title">מתאם וקורלציה</h1>
            <div class="w-16 h-1 bg-blue-600 mt-2"></div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 grid grid-cols-2 gap-6">
            <!-- Left Side - Text and Code -->
            <div class="flex flex-col justify-between">
                <div class="content-text">
                    <p class="mb-3">
                        <strong>מתאם</strong> מודד את חוזק הקשר הליניארי בין שני משתנים (-1 עד +1).
                    </p>
                    <ul class="list-disc list-inside space-y-1 mr-4">
                        <li><strong>+1:</strong> מתאם חיובי מושלם</li>
                        <li><strong>0:</strong> אין מתאם ליניארי</li>
                        <li><strong>-1:</strong> מתאם שלילי מושלם</li>
                        <li><strong>מטריצת מתאם:</strong> מציגה מתאמים בין כל הזוגות</li>
                    </ul>
                </div>

                <div>
                    <h3 class="text-lg font-semibold text-gray-700 mb-2">קוד Python:</h3>
                    <div class="code-block">
<span class="python-keyword">import</span> pandas <span class="python-keyword">as</span> pd
<span class="python-keyword">import</span> numpy <span class="python-keyword">as</span> np
<span class="python-keyword">import</span> seaborn <span class="python-keyword">as</span> sns

<span class="python-comment"># יצירת נתונים מתואמים</span>
np.random.seed(42)
x1 = np.random.normal(0, 1, 200)
x2 = 0.8 * x1 + 0.6 * np.random.normal(0, 1, 200)
x3 = -0.6 * x1 + 0.8 * np.random.normal(0, 1, 200)
x4 = np.random.normal(0, 1, 200)

<span class="python-comment"># יצירת DataFrame</span>
df = pd.DataFrame({
    <span class="python-string">'משתנה A'</span>: x1, <span class="python-string">'משתנה B'</span>: x2,
    <span class="python-string">'משתנה C'</span>: x3, <span class="python-string">'משתנה D'</span>: x4
})

<span class="python-comment"># חישוב מטריצת מתאם</span>
corr_matrix = df.corr()
<span class="python-keyword">print</span>(corr_matrix)
                    </div>
                </div>
            </div>

            <!-- Right Side - Interactive Heatmap -->
            <div class="flex flex-col">
                <div class="bg-white rounded-lg shadow-lg p-4 flex-1">
                    <h3 class="text-xl font-semibold text-gray-800 mb-3 text-center">מטריצת מתאם אינטראקטיבית</h3>
                    <div id="correlationMatrix" style="height: 350px;"></div>
                    <div class="tooltip" id="tooltip"></div>
                </div>
                
                <!-- Chart Analysis -->
                <div class="mt-3 p-3 bg-blue-50 rounded-lg">
                    <h4 class="font-semibold text-blue-800 mb-1">ניתוח מפת החום:</h4>
                    <div class="text-sm text-blue-700">
                        <strong>צבע כחול:</strong> מתאם חיובי | <strong>צבע אדום:</strong> מתאם שלילי | <strong>לבן:</strong> אין מתאם | <strong>אינטראקטיביות:</strong> העבר עכבר לפרטים
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="mt-4 text-center">
            <p class="text-sm text-gray-600">קובץ Python: slide8_correlation_matrix.py</p>
            <p class="text-xs text-gray-400 mt-2" style="opacity: 0.6;">© כל הזכויות שמורות לדר. יורם סגל</p>
        </div>
    </div>

    <script>
        // Correlation matrix data
        const variables = ['משתנה A', 'משתנה B', 'משתנה C', 'משתנה D'];
        const correlationData = [
            [1.00, 0.82, -0.58, 0.03],
            [0.82, 1.00, -0.41, 0.12],
            [-0.58, -0.41, 1.00, -0.08],
            [0.03, 0.12, -0.08, 1.00]
        ];

        // Set up dimensions
        const margin = {top: 50, right: 50, bottom: 50, left: 80};
        const width = 400 - margin.left - margin.right;
        const height = 350 - margin.top - margin.bottom;
        const cellSize = Math.min(width, height) / variables.length;

        // Create SVG
        const svg = d3.select("#correlationMatrix")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        // Color scale
        const colorScale = d3.scaleSequential(d3.interpolateRdBu)
            .domain([-1, 1]);

        // Create tooltip
        const tooltip = d3.select("#tooltip");

        // Create matrix cells
        const rows = svg.selectAll(".row")
            .data(correlationData)
            .enter()
            .append("g")
            .attr("class", "row")
            .attr("transform", (d, i) => `translate(0, ${i * cellSize})`);

        const cells = rows.selectAll(".cell")
            .data((d, i) => d.map((value, j) => ({
                row: i,
                col: j,
                value: value,
                rowVar: variables[i],
                colVar: variables[j]
            })))
            .enter()
            .append("rect")
            .attr("class", "correlation-cell")
            .attr("x", d => d.col * cellSize)
            .attr("y", 0)
            .attr("width", cellSize)
            .attr("height", cellSize)
            .attr("fill", d => colorScale(d.value))
            .on("mouseover", function(event, d) {
                tooltip
                    .style("opacity", 1)
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 10) + "px")
                    .html(`${d.rowVar} ↔ ${d.colVar}<br/>מתאם: ${d.value.toFixed(3)}`);
                
                d3.select(this)
                    .attr("stroke", "#000")
                    .attr("stroke-width", 2);
            })
            .on("mouseout", function() {
                tooltip.style("opacity", 0);
                d3.select(this)
                    .attr("stroke", "#fff")
                    .attr("stroke-width", 1);
            });

        // Add correlation values as text
        rows.selectAll(".cell-text")
            .data((d, i) => d.map((value, j) => ({
                row: i,
                col: j,
                value: value
            })))
            .enter()
            .append("text")
            .attr("class", "correlation-text")
            .attr("x", d => d.col * cellSize + cellSize / 2)
            .attr("y", cellSize / 2)
            .attr("dy", "0.35em")
            .text(d => d.value.toFixed(2))
            .attr("fill", d => Math.abs(d.value) > 0.5 ? "white" : "black");

        // Add row labels
        svg.selectAll(".row-label")
            .data(variables)
            .enter()
            .append("text")
            .attr("class", "axis-label")
            .attr("x", -10)
            .attr("y", (d, i) => i * cellSize + cellSize / 2)
            .attr("dy", "0.35em")
            .attr("text-anchor", "end")
            .text(d => d);

        // Add column labels
        svg.selectAll(".col-label")
            .data(variables)
            .enter()
            .append("text")
            .attr("class", "axis-label")
            .attr("x", (d, i) => i * cellSize + cellSize / 2)
            .attr("y", -10)
            .attr("text-anchor", "middle")
            .text(d => d);

        // Add color legend
        const legendWidth = 200;
        const legendHeight = 10;
        
        const legend = svg.append("g")
            .attr("transform", `translate(${(variables.length * cellSize - legendWidth) / 2}, ${variables.length * cellSize + 30})`);

        const legendScale = d3.scaleLinear()
            .domain([-1, 1])
            .range([0, legendWidth]);

        const legendAxis = d3.axisBottom(legendScale)
            .ticks(5)
            .tickFormat(d3.format(".1f"));

        // Create gradient for legend
        const gradient = svg.append("defs")
            .append("linearGradient")
            .attr("id", "correlation-gradient")
            .attr("x1", "0%")
            .attr("x2", "100%");

        gradient.selectAll("stop")
            .data(d3.range(-1, 1.1, 0.1))
            .enter()
            .append("stop")
            .attr("offset", d => ((d + 1) / 2) * 100 + "%")
            .attr("stop-color", d => colorScale(d));

        legend.append("rect")
            .attr("width", legendWidth)
            .attr("height", legendHeight)
            .style("fill", "url(#correlation-gradient)");

        legend.append("g")
            .attr("transform", `translate(0, ${legendHeight})`)
            .call(legendAxis);

        legend.append("text")
            .attr("x", legendWidth / 2)
            .attr("y", -5)
            .attr("text-anchor", "middle")
            .attr("class", "axis-label")
            .text("מתאם");
    </script>
</body>
</html>

